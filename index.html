<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SUPER KANSAS CA$H</title>
    
    <!-- jQuery link -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    <style>
        main {
            width: 70%;
            margin: auto;
        }
        
        #buttons {
            width: 400px;
        }
        
        .button {
            width: 50px;
            height: 50px;
            border-radius: 100%;
        }
        
        #lotto-numbers {
            color: green;
        }
        
        #pb-number {
            color: red;
        }
        
        #result {
            display: block;
        }
    </style>
</head>
<body>
    <main>
        <h1>SUPER KANSAS CA$H</h1>
        <h2 id="jackpot">Jackpot: $4,000,000</h2>
        <h3>HOW TO PLAY</h3>
        <p>Pick 5 numbers & 1 lucky Powerball number</p>
        <h3>HOW TO WIN</h3>
        <ul id="win-rules"></ul>

        <div id="buttons"></div>
        <button id="reset">RESET</button>
        <button id="play" disabled="true">PLAY</button>
        <span id="lotto-numbers"></span>
        <span id="pb-number"></span>
        <span id="result"></span>
    </main>
    
    <script type="text/javascript">
        function numberWithCommas(x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        };
         
        var winRules = [
            "5 Balls + PB: JACKPOT! (Odds: 1 in 2,517,200)",
            "5 Balls: $2000 (Odds: 1 in 104,883)",
            "4 Balls + PB: $250 (Odds: 1 in 18,646)",
            "4 Balls: $25 (Odds: 1 in 777)",
            "3 Balls + PB: $25 (Odds: 1 in 717)",
            "3 Balls: $2 (Odds: 1 in 30)",
            "2 Balls + PB: $2 (Odds: 1 in 86)",
            "1 Balls + PB: $1 (Odds: 1 in 29)"
        ];
        
        var winElement = $("#win-rules");
        for (i = 0; i < winRules.length; i++) {
            var winRule = $("<li>" + winRules[i] + "</li>");
            winElement.append(winRule);
        }
        
        // Game logic
        // ================
        var userNumbers = [];
        var userPB = 0;
        var buttonsElement = $("#buttons");
        var lottoElement = $("#lotto-numbers");
        var pbElement = $("#pb-number");
        var jackpot = 4000000;
        
        for (i = 1; i <= 31; i++) {
            var btn = $("<button>" + i + "</button>");
            btn.attr("id", "btn-" + i);
            btn.attr("class", "button");
            btn.attr("value", i);            
            buttonsElement.append(btn);
        };
        
        for (i = 1; i <= 31; i++) {
            // For the first 5 buttons clicked, the coorisponding value is added to the user's number array
            $("#btn-" + i).on("click", function () {
                if (userNumbers.length < 5) {
                    var btnValue = $(this).attr("value");
                    userNumbers.push(Number(btnValue));
                    $(this).prop("disabled", true);
                    $(this).css("background-color", "green");
                    $(this).css("color", "white");
                }
                
                // For the 6th button clicked, the coorisponding value is set as the user PB
                else if (userNumbers.length === 5) {
                    if (userPB === 0) {
                        var btnValue = $(this).attr("value");
                        userPB = btnValue;
                        $(this).prop("disabled", true);
                        $(this).css("background-color", "red");
                        $(this).css("color", "white");
                        $("#play").prop("disabled", false);
                    };
                };
                
                console.log(userNumbers);
                console.log(userPB);
            });
        };
        
        // On reset, change multiple objects back to original state
        $("#reset").on("click", function () {
            userNumbers = [];
            userPB = 0;
            $("#result").empty();
            $("#lotto-numbers").empty();
            $("#pb-number").empty();
            $(".button").prop("disabled", false);
            $(".button").css("background-color", "");
            $(".button").css("color", "");
            $("#play").prop("disabled", true);
        });
        
        // When play button is avalible and clicked, run the simulation
        $("#play").on("click", function () {
            $("#result").empty();
            $("#lotto-numbers").empty();
            $("#pb-number").empty();
            userNumbers.sort(function(a, b){return a-b});
            console.log("User: " + userNumbers + " PB:" + userPB);
            
            // Generate 5 lotto numbers + PB
            var lottoNumbers = [];
            for (i = 0; i < 6; i++) {
                var randomNumber = Math.floor(Math.random() * 31) + 1;
                while (lottoNumbers.includes(randomNumber) === true) {
                    randomNumber = Math.floor(Math.random() * 31) + 1;
                };
                lottoNumbers.push(randomNumber);
            };           
            var lottoPB = lottoNumbers[5];
            lottoNumbers.pop();
            lottoNumbers.sort(function(a, b){return a-b});
            console.log("Lotto: " + lottoNumbers + " PB:" + lottoPB);
            
            // Compute matches
            var numberMatches = 0;
            for (i = 0; i < userNumbers.length; i++) {
                if (lottoNumbers.includes(userNumbers[i]) === true) {
                    numberMatches += 1;
                };
            };
            console.log("matches: " + numberMatches);
            
            // Write Balls to html
            
            
            // Compute results
            if (userPB === lottoPB) {
                if (numberMatches === 0) {
                    $("#result").append("You Lose. Better Luck Next Time :(");
                }
                else if (numberMatches === 1) {
                    $("#result").append("You Win $1");
                }
                else if (numberMatches === 2) {
                    $("#result").append("You Win $2");
                }
                else if (numberMatches === 3) {
                    $("#result").append("You Win $25");
                }
                else if (numberMatches === 4) {
                    $("#result").append("You Win $250");
                }
                else if (numberMatches === 5) {
                    $("#result").append("JACKPOT!!!!! $4,000,000");
                }
            }
            else {
                if (numberMatches === 0) {
                    $("#result").append("You Lose. Better Luck Next Time :(");
                }
                else if (numberMatches === 1) {
                    $("#result").append("You Lose. Better Luck Next Time :(");
                }
                else if (numberMatches === 2) {
                    $("#result").append("You Lose. Better Luck Next Time :(");
                }
                if (numberMatches === 3) {
                    $("#result").append("You Win $2");
                }
                else if (numberMatches === 4) {
                    $("#result").append("You Win $25");
                }
                else if (numberMatches === 5) {
                    $("#result").append("You Win $2000");
                }
            }
            
            // Add to Jackpot if not won
            if (userPB === lottoPB) {
                if (numberMatches === 5) {
                    jackpot = 4000000;
                }
            }
            else {
                jackpot += parseInt(jackpot * 0.001)
                console.log(jackpot);
            }
            $("#jackpot").empty();
            $("#jackpot").append("Jackpot: $" +  numberWithCommas(jackpot));
            
            for (i = 0; i < 4; i++) {
                lottoElement.append(lottoNumbers[i] + "&nbsp;&nbsp;&nbsp;");
            }    
            lottoElement.append(lottoNumbers[4]);
            pbElement.append("&nbsp;&nbsp;&nbsp;" + lottoPB);
        });
    </script>
</body>
</html>